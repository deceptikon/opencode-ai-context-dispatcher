#!/bin/bash
# ocx-onboard - Run onboarding session for a project
# Usage: ocx-onboard <project-id>
# 
# Loads the generic onboarding template, replaces project-id placeholder,
# and runs the full onboarding session.

if [[ -z "$1" ]]; then
    echo "Usage: ocx-onboard <project-id>"
    echo ""
    echo "Example:"
    echo "  ocx-onboard 7e304c6738a8b942"
    echo ""
    echo "To see available projects:"
    echo "  ctx list"
    exit 1
fi

PROJECT_ID="$1"

# Find template in ~/.opencode/templates/
TEMPLATE="${HOME}/.opencode/templates/ONBOARDING_PROMPT_TEMPLATE.md"

if [[ ! -f "$TEMPLATE" ]]; then
    echo "Error: Onboarding template not found at $TEMPLATE"
    exit 1
fi

# Extract the prompt section (between "## Generic Onboarding Prompt" and "## Tips")
PROMPT=$(sed -n '/^## Generic Onboarding Prompt/,/^## Tips/p' "$TEMPLATE" | \
    sed '/^## Generic Onboarding Prompt/d' | \
    sed '1d' | \
    sed '/^```$/d' | \
    sed '$ d')

# Replace <project-id> placeholder with actual project ID
PROMPT="${PROMPT//<project-id>/$PROJECT_ID}"

# Run ocx with the prompt
ocx -c full "$PROJECT_ID" "$PROMPT"
